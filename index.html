<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulateur Dice & Roulette</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-6">

<h1 class="text-3xl font-bold mb-6 text-gray-800">Simulateur Dice & Roulette</h1>

<!-- Paramètres Dice -->
<div class="bg-white shadow-md rounded-lg p-6 w-full max-w-xl mb-6">
  <h2 class="text-xl font-bold mb-4">Paramètres Dice</h2>
  <div class="space-y-4">
    <div>
      <label class="block font-medium mb-1">Bankroll initiale (VEF)</label>
      <input id="diceBankroll" type="number" value="1000000000" class="w-full border rounded p-2">
    </div>
    <div>
      <label class="block font-medium mb-1">Mise de départ (VEF)</label>
      <input id="diceBaseBet" type="number" value="100000" class="w-full border rounded p-2">
    </div>
    <div>
      <label class="block font-medium mb-1">Augmentation après perte (%)</label>
      <input id="diceIncreaseLoss" type="number" value="64.44" class="w-full border rounded p-2">
    </div>
    <div>
      <label class="block font-medium mb-1">Augmentation après gain (%)</label>
      <input id="diceIncreaseWin" type="number" value="0" class="w-full border rounded p-2">
      <p class="text-sm text-gray-500">Mettez 0 pour réinitialiser à la mise de départ</p>
    </div>
    <div>
      <label class="block font-medium mb-1">Cote visée (payout)</label>
      <input id="dicePayout" type="number" value="1.98" step="0.01" class="w-full border rounded p-2">
    </div>
    <div>
      <label class="block font-medium mb-1">Probabilité de gain (%)</label>
      <input id="diceWinProb" type="number" value="50" step="0.01" class="w-full border rounded p-2">
      <p class="text-sm text-gray-500">Si tu veux un calcul réaliste : 100 / cote</p>
    </div>
    <div class="grid grid-cols-2 gap-4">
      <div>
        <label class="block font-medium mb-1">Objectif gain (%)</label>
        <input id="diceStopWin" type="number" value="1" step="0.1" class="w-full border rounded p-2">
      </div>
      <div>
        <label class="block font-medium mb-1">Stop perte (%)</label>
        <input id="diceStopLoss" type="number" value="10" step="0.1" class="w-full border rounded p-2">
      </div>
    </div>
    <div>
      <label class="block font-medium mb-1">Nombre de tours max</label>
      <input id="diceTours" type="number" value="2000" class="w-full border rounded p-2">
    </div>
    <button id="simulateDiceBtn" class="w-full bg-blue-600 text-white font-bold py-2 px-4 rounded hover:bg-blue-700">
      Lancer simulation Dice
    </button>
  </div>
</div>

<!-- Résultats -->
<div class="bg-white shadow-md rounded-lg p-6 w-full max-w-5xl">
  <canvas id="bankrollChart" class="w-full h-64 mb-6"></canvas>
  <div id="summary" class="text-gray-700 font-medium"></div>
  <div id="maxLossStreak" class="text-gray-700 font-medium mt-2"></div>
  <div id="stopReason" class="text-gray-700 font-medium mt-2"></div>
</div>

<script>
const ctx = document.getElementById('bankrollChart').getContext('2d');
let chart = null;

// Simulation Dice avec payout personnalisé
function simulateDice(bankroll, baseBet, incLossFactor, incWinFactor, winProb, payout, stopWinPct, stopLossPct, maxTours) {
  let currentBankroll = bankroll;
  let bet = baseBet;
  const results = [];
  let currentLossStreak = 0;
  let maxLossStreak = 0;
  const pGain = winProb / 100;

  const profitTarget = bankroll * (1 + stopWinPct / 100);
  const stopLoss = bankroll * (1 - stopLossPct / 100);

  let i = 0;
  let reason = "Max tours atteints";

  while (i < maxTours) {
    if (bet > currentBankroll) {
      reason = "Bankroll trop faible pour miser";
      break;
    }
    if (currentBankroll >= profitTarget) {
      reason = `Objectif gain atteint (+${stopWinPct}%)`;
      break;
    }
    if (currentBankroll <= stopLoss) {
      reason = `Stop perte atteint (-${stopLossPct}%)`;
      break;
    }

    if (Math.random() < pGain) {
      // Victoire
      currentBankroll += bet * (payout - 1);
      currentLossStreak = 0;
      bet = (incWinFactor === 1 || incWinFactor === 0) ? baseBet : bet * incWinFactor;
    } else {
      // Défaite
      currentBankroll -= bet;
      currentLossStreak++;
      if (currentLossStreak > maxLossStreak) maxLossStreak = currentLossStreak;
      bet *= incLossFactor;
    }

    results.push(currentBankroll);
    i++;
  }

  const maxDrawdown = Math.max(...results.map(v => Math.max(...results) - v));
  const finalBankroll = results[results.length - 1] || currentBankroll;
  return {results, maxDrawdown, finalBankroll, maxLossStreak, tours: i, reason};
}

// Graphique
function renderChart(results, color) {
  if (chart) chart.destroy();
  chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: results.map((_, i) => i + 1),
      datasets: [{
        label: "Bankroll (VEF)",
        data: results,
        borderColor: color,
        backgroundColor: color.replace("rgb", "rgba").replace(")", ",0.2)"),
        tension: 0.2
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false } }
    }
  });
}

// Lancer simulation
document.getElementById('simulateDiceBtn').addEventListener('click', () => {
  const bankroll = parseFloat(document.getElementById('diceBankroll').value);
  const baseBet = parseFloat(document.getElementById('diceBaseBet').value);
  const incLoss = parseFloat(document.getElementById('diceIncreaseLoss').value) / 100 + 1;
  const incWin = parseFloat(document.getElementById('diceIncreaseWin').value) / 100 + 1;
  const payout = parseFloat(document.getElementById('dicePayout').value);
  const winProb = parseFloat(document.getElementById('diceWinProb').value);
  const stopWinPct = parseFloat(document.getElementById('diceStopWin').value);
  const stopLossPct = parseFloat(document.getElementById('diceStopLoss').value);
  const tours = parseInt(document.getElementById('diceTours').value);

  const {results, maxDrawdown, finalBankroll, maxLossStreak, tours: totalTours, reason} =
    simulateDice(bankroll, baseBet, incLoss, incWin, winProb, payout, stopWinPct, stopLossPct, tours);

  renderChart(results, 'rgb(59,130,246)');
  document.getElementById('summary').innerHTML =
    `Bankroll finale : <span class="font-bold">${finalBankroll.toLocaleString()} VEF</span><br>
     Max drawdown : <span class="font-bold">${maxDrawdown.toLocaleString()} VEF</span><br>
     Nombre de tours joués : <span class="font-bold">${totalTours}</span>`;
  document.getElementById('maxLossStreak').innerHTML =
    `Plus longue série de pertes : <span class="font-bold">${maxLossStreak}</span> tours`;
  document.getElementById('stopReason').innerHTML =
    `Raison d'arrêt : <span class="font-bold">${reason}</span>`;
});
</script>

</body>
</html>
