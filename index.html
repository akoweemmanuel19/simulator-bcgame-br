<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulateur Dice R2Cap</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-6">

  <h1 class="text-3xl font-bold mb-6 text-gray-800">Simulateur Dice R2Cap</h1>

  <!-- Paramètres -->
  <div class="bg-white shadow-md rounded-lg p-6 w-full max-w-xl mb-6">
    <div class="space-y-4">
      <div>
        <label class="block font-medium mb-1">Bankroll initiale (VEF)</label>
        <input id="bankroll" type="number" value="1000000000" class="w-full border rounded p-2">
      </div>
      <div>
        <label class="block font-medium mb-1">Mise de départ (VEF)</label>
        <input id="baseBet" type="number" value="100000" class="w-full border rounded p-2">
      </div>
      <div>
        <label class="block font-medium mb-1">Augmentation après perte (%)</label>
        <input id="increaseLoss" type="number" value="45" class="w-full border rounded p-2">
      </div>
      <div>
        <label class="block font-medium mb-1">Cote</label>
        <input id="odds" type="number" value="3" step="0.1" class="w-full border rounded p-2">
      </div>
      <div>
        <label class="block font-medium mb-1">Probabilité de gain (%)</label>
        <input id="winProb" type="number" value="33" step="0.1" class="w-full border rounded p-2">
      </div>
      <div>
        <label class="block font-medium mb-1">Tours par jour</label>
        <input id="tours" type="number" value="2000" class="w-full border rounded p-2">
      </div>
      <div>
        <label class="block font-medium mb-1">Profit cible (VEF)</label>
        <input id="profitTarget" type="number" value="10000000" class="w-full border rounded p-2">
      </div>
      <button id="simulateBtn" class="w-full bg-blue-600 text-white font-bold py-2 px-4 rounded hover:bg-blue-700">
        Lancer la simulation (2000 tours)
      </button>
      <button id="simulateProfitBtn" class="w-full bg-purple-600 text-white font-bold py-2 px-4 rounded hover:bg-purple-700">
        Lancer la simulation (objectif profit)
      </button>
    </div>
  </div>

  <!-- Résultats -->
  <div class="bg-white shadow-md rounded-lg p-6 w-full max-w-5xl">
    <canvas id="bankrollChart" class="w-full h-64 mb-6"></canvas>
    <div id="summary" class="text-gray-700 font-medium"></div>
    <div id="maxLossStreak" class="text-gray-700 font-medium mt-2"></div>
  </div>

<script>
const ctx = document.getElementById('bankrollChart').getContext('2d');
let chart = null;

// Simulation : progression uniquement sur perte
function simulateDice(bankroll, baseBet, incLossFactor, numTours, winProb, profitTarget=null) {
    let currentBankroll = bankroll;
    let bet = baseBet;
    const results = [];

    let currentLossStreak = 0;
    let maxLossStreak = 0;
    const pGain = winProb / 100; // probabilité de gain personnalisée
    const target = profitTarget ? bankroll + profitTarget : null;

    for (let i = 0; i < numTours; i++) {
        if (bet > currentBankroll) break;

        if (Math.random() < pGain) { 
            // GAIN → reset mise
            currentBankroll += bet * ((1 / pGain) - 1); // utilise la cote implicite
            currentLossStreak = 0;
            bet = baseBet;
        } else { 
            // PERTE → progression
            currentBankroll -= bet;
            currentLossStreak++;
            if (currentLossStreak > maxLossStreak) maxLossStreak = currentLossStreak;
            bet *= incLossFactor;
        }

        results.push(currentBankroll);

        if (target && currentBankroll >= target) break;
    }

    const maxDrawdown = Math.max(...results.map(v => Math.max(...results) - v));
    const finalBankroll = results[results.length - 1] || currentBankroll;

    return {results, maxDrawdown, finalBankroll, maxLossStreak};
}

// Graphique
function renderChart(results, color, label="Bankroll (VEF)") {
    if(chart) chart.destroy();
    chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: results.map((_, i) => i+1),
            datasets: [{
                label,
                data: results,
                borderColor: color,
                backgroundColor: color.replace("rgb","rgba").replace(")",",0.2)"),
                tension: 0.2
            }]
        },
        options: {responsive: true, plugins:{legend:{display:false}}}
    });
}

// Simulation classique
document.getElementById('simulateBtn').addEventListener('click', () => {
    const bankroll = parseFloat(document.getElementById('bankroll').value);
    const baseBet = parseFloat(document.getElementById('baseBet').value);
    const incLoss = parseFloat(document.getElementById('increaseLoss').value)/100 + 1;
    const winProb = parseFloat(document.getElementById('winProb').value);
    const tours = parseInt(document.getElementById('tours').value);

    const {results, maxDrawdown, finalBankroll, maxLossStreak} = simulateDice(bankroll, baseBet, incLoss, tours, winProb);

    renderChart(results, 'rgb(59,130,246)');
    document.getElementById('summary').innerHTML = `
        Bankroll finale : <span class="font-bold">${finalBankroll.toLocaleString()} VEF</span><br>
        Max drawdown : <span class="font-bold">${maxDrawdown.toLocaleString()} VEF</span>
    `;
    document.getElementById('maxLossStreak').innerHTML = `
        Plus longue série de pertes : <span class="font-bold">${maxLossStreak}</span> tours
    `;
});

// Simulation jusqu'à profit cible
document.getElementById('simulateProfitBtn').addEventListener('click', () => {
    const bankroll = parseFloat(document.getElementById('bankroll').value);
    const baseBet = parseFloat(document.getElementById('baseBet').value);
    const incLoss = parseFloat(document.getElementById('increaseLoss').value)/100 + 1;
    const winProb = parseFloat(document.getElementById('winProb').value);
    const profitTarget = parseFloat(document.getElementById('profitTarget').value);
    const tours = 1000000;

    const {results, maxDrawdown, finalBankroll, maxLossStreak} = simulateDice(bankroll, baseBet, incLoss, tours, winProb, profitTarget);

    renderChart(results, 'rgb(147,51,234)');
    document.getElementById('summary').innerHTML = `
        Objectif de profit : <span class="font-bold">${profitTarget.toLocaleString()} VEF</span><br>
        Bankroll finale : <span class="font-bold">${finalBankroll.toLocaleString()} VEF</span><br>
        Tours joués : <span class="font-bold">${results.length}</span><br>
        Max drawdown : <span class="font-bold">${maxDrawdown.toLocaleString()} VEF</span>
    `;
    document.getElementById('maxLossStreak').innerHTML = `
        Plus longue série de pertes : <span class="font-bold">${maxLossStreak}</span> tours
    `;
});
</script>

</body>
</html>
